<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>ADVANTECH</title>
        <link href="style.css" rel="stylesheet" type="text/css" />
        <script src="jquery.js"></script>
    </head>  	
  <body>
  	<div class="container" style="text-align: center">
      <header class="page-header" style="position: relative; text-align: left;">
          <span style="margin: 0 0 0 0; margin-left:35px; font-size:2.0em; font-weight: bold; color: #FFF; display: inline-block">WISE-4060/LAN</span>
          <br/>
          <span style="margin: 0 0 0 0; margin-left:35px;font-size:1.2em; font-weight: bold; color: #FFF; display: inline-block">4-ch Digital Input / 4-ch Relay Output IoT Ethernet I/O Module</span>
          <span style=" top: 0; right: 0; position: absolute; margin:0 1% 0 0; margin-right:20px; color:#FFF ">Version 1.0.2</span>
      </header>
      <div class="row">
          <div class="panel-body col-sm-12" style="text-align: left;">
              <table border="0" align="left" cellpadding="0" cellspacing="0">
                	<tr>
                	    <td  colspan="3" valign="top">
                    	  	<table width="100%"  border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td valign="top">
                                	 <table border="0" cellpadding="0" cellspacing="0">
                                      <tr>
                                         <td ><button class="btn btn-lg btn-default" onclick="pageOnBtnIntroductionClick()" style="margin-top: -15px;padding:4px 110px 2px 5px; font-size: 0.8em; " >Introduction</button></td>
                                      </tr>
                                      <tr>
                                        <td height="12"></td>
                                      </tr>
                                      <tr>
                                        <td><button class="btn btn-lg btn-default" onclick="pageOnBtnGetModuleInfoClick(1)" style="margin-top: -15px;padding:4px 103px 2px 5px; font-size: 0.8em; " >Device Profile</button></td>
                                      </tr>
                                      <tr>
                                        <td height="12"></td>
                                      </tr>
                                      <tr>
                                        <td ><button class="btn btn-lg btn-default" onclick="pageOnBtnGetModuleInfoClick(2)" style="margin-top: -15px;padding:4px 19px 2px 5px; font-size: 0.8em; " >Network Config Information</button></td>
                                      </tr>
                                      <tr>
                                        <td height="12"> </td>
                                      </tr>
                                   </table>
                                </td>
                                <td valign="top">
                                	 <table width="98%"  border="0" align="left" cellpadding="0" cellspacing="0">
                                      <tr>
                                        <td>&nbsp;</td>
                                        <td width="800"><div id="BulletinBoard" style="padding:5px 5px 0px 25px; align="justify">The WISE-4000/LAN series provide a cost-effective solution for cloud applications. By supporting direct cloud access, new web service and datalog, the WISE-4000/LAN series can seamlessly connect to cloud for an Ethernet solution.</div></td>
                                        <td>&nbsp;</td>
                                      </tr>
                                      <tr>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                      </tr>
                                      <tr>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                      </tr>
                                   </table>
                                </td>
                            </tr>
                          </table>
                      </td>
                  </tr>            	
              </table>
          </div>
          <div class="panel-body col-sm-6" style="text-align: left;">
              <div class="col-sm-12" style="display: inline-block">
                 <span style="margin-left:10px; font-size:1.1em; font-weight: bold; color: #0066FF; display: inline-block">Trend Log</span>                              	
              </div>
              <div id= "canvasContainer" class="col-sm-12" style="display: inline-block">
              	<canvas id="adamCanvas">
                   Your browser doesn't support Canvas! Historical data disabled!
                </canvas>
              </div>
              
              <br/><br/>              
              <div class="panel col-sm-12" style="display: inline-block">
                	<table border="0" align="left" cellpadding="0" cellspacing="0">
                		<tr>&nbsp;</tr>
                    <tr>
                    	<td width="30">&nbsp;</td>
                      <td width="120"><button class="btn btn-danger btn3d" id="BtnToggle" onclick="pageOnToggleClick()" style="border-radius: 50%; border: 5px #FFF solid; width: 98px; height: 80px; padding: 8px 11px; line-height: 1.33; font-weight: bold; font-size: 17px; margin: 5% 2% 0 0">STOP</button></td>
                      <td width="120"><button class="btn btn-warning btn3d"  id="BtnReset" onclick="pageOnResetClick()" style="border-radius: 50%; border: 5px #FFF solid; width: 98px; height: 80px; padding: 8px 11px; line-height: 1.33; font-weight: bold; font-size: 17px; margin: 5% 2% 0 0">RESET</button></td>
                    </tr>
                  </table>              	
              </div>          
          </div>
          <div class="panel-body col-sm-6" style="text-align: left;">
          	<div class="panel-body col-sm-12" style="text-align: left; margin-left:35px; color:#0066FF; font-size:1.0em;">
          		<div id="DIPOLL" style="align="justify">Waiting...</div>
          	</div>
          	<div class="panel-body col-sm-12" style="text-align: left; margin-left:35px; color:#0066FF; font-size:1.0em; font-weight: bold;">
 				       <table border="0" align="left" cellpadding="0" cellspacing="0">
                  <tr>
                  	<td width="100">DI-0</td>
                    <td width="100">DI-1</td>
                    <td width="100">DI-2</td>
                    <td width="100">DI-3</td>
                  </tr>
               </table> 						  						  						  
            </div>          	
          	<div id="panelDiStatus" class="panel-body col-sm-12" style="text-align: left; margin-left:35px;">
          		 <table border="0" align="left" cellpadding="0" cellspacing="0">
                  <tr>
                  	<td width="100"><img id="DI0" alt="0"></td>
                    <td width="100"><img id="DI1" alt="0"></td>
                    <td width="100"><img id="DI2" alt="0"></td>
                    <td width="100"><img id="DI3" alt="0"></td>
                  </tr>
               </table>
            </div>
            <div class="panel-body col-sm-12" style="text-align: left; margin-left:35px; color:#0066FF; font-size:1.0em;">
          		<div id="DOPOLL" style="align="justify">Waiting...</div>
          	</div>
          	<div class="panel-body col-sm-12" style="text-align: left; margin-left:35px; color:#0066FF; font-size:1.0em; font-weight: bold;">
		       <table border="0" align="left" cellpadding="0" cellspacing="0">
                  <tr>
                  	<td width="100">DO-0</td>
                    <td width="100">DO-1</td>
                    <td width="100">DO-2</td>
                    <td width="100">DO-3</td>
                  </tr>
               </table> 	          		
            </div>          	
          	<div id="panelDoStatus" class="panel-body col-sm-12" style="text-align: left; margin-left:35px;">
          		 <table border="0" align="left" cellpadding="0" cellspacing="0">
                  <tr>
                  	<td width="100"><img id="DO0" alt="0"></td>
                    <td width="100"><img id="DO1" alt="0"></td>
                    <td width="100"><img id="DO2" alt="0"></td>
                    <td width="100"><img id="DO3" alt="0"></td>
                  </tr>
               </table>
            </div>
            <div class="form-group col-sm-12" style="display: inline-block; margin-left:25px;">
 				       <table border="0" align="left" cellpadding="0" cellspacing="0">
                  <tr>
                  	<td width="100"><button id="BTNDO0" onclick="pageOnApplyClick(0)" class="btn btn-primary">DO-0</button></td>
                    <td width="100"><button id="BTNDO1" onclick="pageOnApplyClick(1)" class="btn btn-primary">DO-1</button></td>
                    <td width="100"><button id="BTNDO2" onclick="pageOnApplyClick(2)" class="btn btn-primary">DO-2</button></td>
                    <td width="100"><button id="BTNDO3" onclick="pageOnApplyClick(3)" class="btn btn-primary">DO-3</button></td>
                  </tr>
               </table> 						  						  						              	
            </div>
          </div>
      </div>
      <br/>
      <footer>
      	<span style="color:#FFF "><a target="_self" href="/" style="color:#00BBFF">Back to Login</a></span>
      	<br/>
      	<span style="color:#FFF ">Copyright &copy;2015 by <a target="_blank" href="http://www.advantech.com/" style="color:#00BBFF">Advantech Corp</a></span>      	
      </footer>
    </div>
  </body>
</html>

<script>
  var canvas;
  var ctx;
  var scanInterval = 1000;
  var diTotal = 4;
  var doTotal = 4;
  var padSize = 30;
  var gridSize = 16;
  var columnInc = 0;
  var stepSize = 8;
  var fontSize = 10;
  var lightOnSrc, lightOffSrc;
  var diStatus;
  var doStatus;
  var cntMaxTotal, cntIndex, cntTotal;
  var diDataArray;
  var doDataArray;
  var diPolling, diPollingCount;
  var doPolling, doPollingCount;
  var diFailCount, diWaitCount;
  var doFailCount, doWaitCount;
  var maxWait = 5;
  var maxFail = 3;
  var statusStop = 0;
  var statusRunning = 1;
  var statusRestart = 2;
  var trendDrawFlag = 1; 

  $(document).ready(function() {
  	$('body').hide().fadeIn(1000);
  	pageOnInit();
  });
 
  function AdamTrend_Init()
  {
  	diStatus = new Array(diTotal);
  	doStatus = new Array(doTotal);
  	lightOnSrc  = "data:image/png;base64,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";
  	lightOffSrc = "data:image/png;base64,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";
  	diPollingCount = 0;
  	doPollingCount = 0;
  	diPolling = 0;
  	doPolling = 0;
  	diFailCount = 0;
  	doFailCount = 0;
  	diWaitCount = 0; 
  	doWaitCount = 0;
  	
  	//
  	$('#panelDiStatus img').attr('src', lightOffSrc);
    $('#panelDoStatus img').attr('src', lightOffSrc);
  	//
  	canvas = document.getElementById("adamCanvas");
  	try
  	{
  		ctx = canvas.getContext("2d");
  		canvas.width = document.getElementById("canvasContainer").offsetWidth;
  		canvas.height = padSize*2 + gridSize*(diTotal+doTotal)+gridSize/2;
  		// deal with data
  		cntMaxTotal = Math.floor((canvas.clientWidth - padSize*2)/stepSize) + 1;
  		cntTotal = 0;
  		cntIndex = 0;
  	}
  	catch (e)
  	{
  		ctx = null;
  		alert("Your browser doesn't support Canvas! The historical data will not be shown!");
  	}
  }
  
  function AdamTrend_DrawLabel()
  {
  	var iCnt, x, y1, y2;
  
  	diDataArray = new Array(diTotal);
  	doDataArray = new Array(doTotal);
  	ctx.font=fontSize+"px Arial";
  	// new data array & draw label
  	x = canvas.width - padSize + 1;
  	y1 = padSize+((gridSize+fontSize)/2);
  	for (var iCh=0; iCh<diTotal; iCh++)
  	{
  		diDataArray[iCh] = new Array(cntMaxTotal);
  		y2 = y1 + gridSize*iCh;
  		ctx.fillText("DI-"+iCh, 0, y2);
  		ctx.fillText("DI-"+iCh, x, y2);
  	}
  	// new data array & draw label
  	y1 = padSize+gridSize*diTotal+((gridSize+fontSize)/2);
  	for (var iCh=0; iCh<doTotal; iCh++)
  	{
  		doDataArray[iCh] = new Array(cntMaxTotal);
  		y2 = y1 + gridSize*iCh;
  		ctx.fillText("DO-"+iCh, 0, y2);
  		ctx.fillText("DO-"+iCh, x, y2);
  	}
  	// draw buttom label
  	y1 = canvas.clientHeight - padSize;
  	y2 = y1 + 10;
  	x = canvas.clientWidth - padSize;
    ctx.fillStyle="#000000";
  	ctx.strokeStyle="#000000";
  	ctx.lineWidth=1;
  	iCnt = 0;
  	while (x >= padSize)
  	{
  		ctx.beginPath();
  		ctx.moveTo(x, y1);
  		ctx.lineTo(x, y2);
  		ctx.stroke();
  		if (iCnt < 10)
  			ctx.fillText(iCnt, x-3, y2+fontSize+2);
  		else
  			ctx.fillText(iCnt, x-6, y2+fontSize+2);
  		//
  		iCnt += Math.floor((gridSize*2/stepSize)*scanInterval/1000);
  		x -= gridSize*2;
  	}
  }
  
  function AdamTrend_UpdateData()
  {
  	if (cntTotal == 0)
  	{
  		cntIndex = 0;
  		cntTotal = 1;
  	}
  	else if (cntTotal < cntMaxTotal)
  	{
  		cntTotal++;
  		cntIndex++;
  	}
  	else
  	{
  		if (cntIndex < cntMaxTotal - 1)
  			cntIndex++;
  		else
  			cntIndex = 0;
  	}
  	//
  	for (var iCh=0; iCh<diTotal; iCh++)
  		diDataArray[iCh][cntIndex] = diStatus[iCh];
  	for (var iCh=0; iCh<doTotal; iCh++)
  		doDataArray[iCh][cntIndex] = doStatus[iCh];
  }
  
  function AdamTrend_RefreshDataLine(iType, iCh)
  {
  	var iCnt, iIdx, x, yOn, yOff
  	var preX, preVal, val;
  	var y = new Array(2);
  	if (cntTotal > 1)
  	{
  		if (iType == 0) // DI
  		{
  			y[0] = padSize+gridSize+gridSize*iCh; // channel OFF
  			y[1] = padSize+gridSize+gridSize*iCh-gridSize/2; // channel ON
  			ctx.strokeStyle="#FFA500";
  			ctx.fillStyle="#FFA500";
  		}
  		else
  		{
  			y[0] = padSize+gridSize*(diTotal+1)+gridSize*iCh; // channel OFF
  			y[1] = padSize+gridSize*(diTotal+1)+gridSize*iCh-gridSize/2; // channel ON
  			ctx.strokeStyle="#FF3300";
  			ctx.fillStyle="#FF3300";
  		}
  		iCnt = 0;
  		iIdx = cntIndex;
  		ctx.lineWidth=1;
  		ctx.beginPath();
  		while (iCnt < cntTotal)
  		{
  			x = canvas.clientWidth - padSize - stepSize*iCnt -1;
  			if (x < padSize)
  				x = padSize;
  			if (iType == 0) // DI
  				val = diDataArray[iCh][iIdx];
  			else
  				val = doDataArray[iCh][iIdx];
  			//
  			if (iCnt == 0)
  				ctx.moveTo(x, y[val]);
  			else
  			{
  				if (preVal == val)
  					ctx.lineTo(x, y[val]);
  				else
  				{
  					ctx.lineTo(preX, y[val]);
  					ctx.lineTo(x, y[val]);
  				}
  				// to fill high part
  				if (val == 1)
  					ctx.fillRect(x, y[1], stepSize, gridSize/2 + 1);
  			}
  			//
  			preX = x;
  			preVal = val;
  			if (iIdx == 0)
  				iIdx = cntTotal - 1;
  			else
  				iIdx--;
  			iCnt++;
  		}
  		ctx.stroke();
  	}
  }
  
  function AdamTrend_RefreshCanvas()
  {
  	// Fill with gradient
  	ctx.fillStyle="#FFFAFA";
  	ctx.fillRect(padSize, padSize, canvas.clientWidth - padSize*2, canvas.clientHeight - padSize*2);
  	// draw row	
  	ctx.strokeStyle="#DCDCDC";
  	ctx.lineWidth=1;
  	for (var y=padSize; y<canvas.clientHeight - padSize; y+=gridSize)
  	{
  		ctx.beginPath();
  		ctx.moveTo(padSize, y);
  		ctx.lineTo(canvas.clientWidth - padSize, y);
  		ctx.stroke();
  	}
  	// draw column
  	for (var x = canvas.clientWidth - padSize - columnInc; x > padSize; x -= gridSize)
  	{
  		ctx.beginPath();
  		ctx.moveTo(x, padSize);
  		ctx.lineTo(x, canvas.clientHeight - padSize);
  		ctx.stroke();
  	}
  	columnInc += stepSize;
  	if (columnInc >= gridSize)
  		columnInc -= gridSize;
  	// draw data line
  	for (var iCh=0; iCh<diTotal; iCh++)
  		AdamTrend_RefreshDataLine(0, iCh);
  	for (var iCh=0; iCh<doTotal; iCh++)
  		AdamTrend_RefreshDataLine(1, iCh);
  	// draw border
  	ctx.strokeStyle="#E6E6FA";
  	ctx.lineWidth=2;
  	ctx.beginPath();
  	ctx.moveTo(padSize - 1, padSize - 1);
  	ctx.lineTo(canvas.clientWidth - padSize + 1, padSize - 1);
  	ctx.lineTo(canvas.clientWidth - padSize + 1, canvas.clientHeight - padSize + 1);
  	ctx.lineTo(padSize - 1, canvas.clientHeight - padSize + 1);
  	ctx.lineTo(padSize - 1, padSize - 1);
  	ctx.stroke();
  }   
  
  function pageOnBtnIntroductionClick()
  {
  	var str_Introduction = "";
  	str_Introduction = str_Introduction + "<p>";
  	str_Introduction = str_Introduction + "The WISE-4000/LAN series provide a cost-effective solution for cloud applications. By supporting direct cloud access, new web service and datalog, the WISE-4000/LAN series can seamlessly connect to cloud for an Ethernet solution.";
  	str_Introduction = str_Introduction + "</p>";
  	$('#BulletinBoard').html(str_Introduction).hide().fadeIn(1000);
  }
  
  function pageOnBtnGetModuleInfoClick(iFunIdx)
  {
  	var http_request = null;
  	var int_FadeInTime = 1000;
  	var str_ModuleInfo = "";
  	var str_URL = "";

  	if (iFunIdx == 1)
  	{
  		str_URL = "sys_info";
  	}
  	else
  	{
  		str_URL = "net_basic";
  	}
	
  	try
  	{
		if (window.XMLHttpRequest)
		{// code for IE7+, Firefox, Chrome, Opera, Safari
			http_request = new XMLHttpRequest();
		}
		else
		{// code for IE6, IE5
			http_request = new ActiveXObject("Microsoft.XMLHTTP");
		}
		
		http_request.onreadystatechange=function()
		{			
			if (http_request.readyState==4)
			{
				if (http_request.status==200)
				{						
					try
					{
						//Javascript function JSON.parse to parse JSON data
						var jsonObj;
						jsonObj = JSON.parse(http_request.responseText);
						
						if( jsonObj!=null && jsonObj!=undefined)
						{
							if (iFunIdx == 1)
							{
								str_ModuleInfo = str_ModuleInfo + "<p>";
								str_ModuleInfo = str_ModuleInfo + "Model ID : " + jsonObj.Id.trim() + "<br/>"; 
								str_ModuleInfo = str_ModuleInfo + "User Defined Module Name : " + jsonObj.Nm.trim() + "<br/>"; 
								str_ModuleInfo = str_ModuleInfo + "Module Description : " + jsonObj.Des.trim() + "<br/>"; 
								str_ModuleInfo = str_ModuleInfo + "UUID : " + jsonObj.UID.trim();
								str_ModuleInfo = str_ModuleInfo + "</p>";  									
						  }
							else
							{
								str_ModuleInfo = str_ModuleInfo + "<p>";
								str_ModuleInfo = str_ModuleInfo + "MAC address : " + jsonObj.MAC.trim() + "<br/>"; 
								str_ModuleInfo = str_ModuleInfo + "IP Address : " + jsonObj.IP.trim() + "<br/>";
								str_ModuleInfo = str_ModuleInfo + "Subnet Mask : " + jsonObj.Msk.trim() + "<br/>";
								str_ModuleInfo = str_ModuleInfo + "Gateway Address : " + jsonObj.GW.trim();
								str_ModuleInfo = str_ModuleInfo + "</p>";  									
							}
							
							$('#BulletinBoard').html(str_ModuleInfo).hide().fadeIn(int_FadeInTime);
						}
						else
						{
							str_ModuleInfo = str_ModuleInfo + "<p>";
							str_ModuleInfo = str_ModuleInfo + "Err: JSON parse failed!";
							str_ModuleInfo = str_ModuleInfo + "</p>";
							$('#BulletinBoard').html(str_ModuleInfo).hide().fadeIn(int_FadeInTime);
						}
					}
					catch(e)
					{
						str_ModuleInfo = str_ModuleInfo + "<p>";
						str_ModuleInfo = str_ModuleInfo + "Err: ResponseText is not a valid JSON string!";
						str_ModuleInfo = str_ModuleInfo + "</p>";
						$('#BulletinBoard').html(str_ModuleInfo).hide().fadeIn(int_FadeInTime);            		
					}					  
				}
				else
				{
					str_ModuleInfo = str_ModuleInfo + "<p>";
					str_ModuleInfo = str_ModuleInfo + "Err: http_request.status = " + http_request.status;
					str_ModuleInfo = str_ModuleInfo + "</p>";
					$('#BulletinBoard').html(str_ModuleInfo).hide().fadeIn(int_FadeInTime);            		  						
				}
			}
		}			

		http_request.open( "GET", str_URL, true );
		http_request.send();
  	}
  	catch(e)
  	{
  		$('#BulletinBoard').text(" Err: " + e + "!").hide().fadeIn(int_FadeInTime);
  	}
  }
  
  function pageOnToggleClick()
  {
  	var btnElement;
  	if (trendDrawFlag == statusRunning)
  	{
  		document.getElementById("BtnToggle").className = "btn btn-success btn3d";
  		btnElement = document.getElementById("BtnToggle");
  		btnElement.firstChild.data = "START";
  		trendDrawFlag = 0;		
  	}
  	else
  	{
  		document.getElementById("BtnToggle").className = "btn btn-danger btn3d";
  		btnElement = document.getElementById("BtnToggle");
  		btnElement.firstChild.data = "STOP";		
  		trendDrawFlag = 1;
  	}
  }
  
  function pageOnResetClick()
  {
  	var btnElement;
  	document.getElementById("BtnToggle").className = "btn btn-danger btn3d";
  	btnElement = document.getElementById("BtnToggle");
  	btnElement.firstChild.data = "STOP";			
  	trendDrawFlag = 2;	
  } 
  
  function pageOnInit()
  {
  	AdamTrend_Init();
  	if (ctx != null)
  		AdamTrend_DrawLabel();
  	pageOnTimer();
  }
  
  function pageOnTimer()
  {
  	httpGetDiData();
  	httpGetDoData();
  	if (ctx != null)
  	{
  		if (trendDrawFlag == statusRestart)
  		{
  				AdamTrend_Init();
  	      if (ctx != null)
  	      {
  		      AdamTrend_DrawLabel();
  		      trendDrawFlag = statusRunning;
  		    }
  		}
  		if (trendDrawFlag == statusRunning)
  		{
  		  AdamTrend_UpdateData();
  		  AdamTrend_RefreshCanvas();
  	  }
  	}
  	
  	pageUpdateLights();
  	
  	if (diFailCount == maxFail)
  	{
     	for (var iCh=0; iCh<doTotal; iCh++)
     	{
     		document.getElementById("BTNDO"+iCh).disabled = true;
     	}  		
  		alert("DI polling has failed " + maxFail + " times, polling suspended!");
  	}
  	else if (doFailCount == maxFail)
  	{
     	for (var iCh=0; iCh<doTotal; iCh++)
     	{
     		document.getElementById("BTNDO"+iCh).disabled = true;
     	}  		
  		alert("DO polling has failed " + maxFail + " times, polling suspended!");
  	}
  	else
  	{
  	  setTimeout(function(){pageOnTimer()}, scanInterval); 	
  	}
  }
  
  function pageUpdateLights()
  {
  	for (var iCh=0; iCh<diTotal; iCh++)
  	{
  		if (document.getElementById("DI" + iCh).alt == "0" && diStatus[iCh] == 1)
  		{
  			document.getElementById("DI" + iCh).alt = "1";
  			document.getElementById("DI" + iCh).src = lightOnSrc;
  		}
  		else if (document.getElementById("DI" + iCh).alt == "1" && diStatus[iCh] == 0)
  		{
  			document.getElementById("DI" + iCh).alt = "0";
  			document.getElementById("DI" + iCh).src = lightOffSrc;
  		}
  	}
  	for (var iCh=0; iCh<doTotal; iCh++)
  	{
  		if (document.getElementById("DO" + iCh).alt == "0" && doStatus[iCh] == 1)
  		{
  			document.getElementById("DO" + iCh).alt = "1";
  			document.getElementById("DO" + iCh).src = lightOnSrc;
  		}
  		else if (document.getElementById("DO" + iCh).alt == "1" && doStatus[iCh] == 0)
  		{
  			document.getElementById("DO" + iCh).alt = "0";
  			document.getElementById("DO" + iCh).src = lightOffSrc;
  		}
  	}
  }  
  
  function pageOnApplyClick(iChIdx)
  {
    var http_request = null;
  	var szPatchData = "";
  	var doValObject = {
      DOVal: []
    };
  	
  	if (document.getElementById("DO" + iChIdx).alt == "0")
  	{
  		doSettingVal = 1;
  	}
  	else //if (document.getElementById("DO" + iChIdx).alt == "1")
  	{
      doSettingVal = 0;
  	}
  	
   	doValObject.DOVal.push({
          "Ch"  : iChIdx,
          "Val" : doSettingVal   		
    });		  	  	
  	
  	szPatchData = JSON.stringify(doValObject);
  		
  	try
  	{
  		if (window.XMLHttpRequest)
  		{// code for IE7+, Firefox, Chrome, Opera, Safari
  			http_request = new XMLHttpRequest();
  		}
  		else
  		{// code for IE6, IE5
  			http_request = new ActiveXObject("Microsoft.XMLHTTP");
  		}
  		http_request.onreadystatechange=function()
  		{
  			if (http_request.readyState==4)
  			{
  				if (http_request.status==200)
  				{
  					var xmlDoc = http_request.responseXML;
  					if (xmlDoc != null && xmlDoc.documentElement.attributes[0].nodeValue != "OK")
  						alert("Set DO failed! " + xmlDoc.documentElement.attributes[0].nodeValue);
  				}
  				else
  					alert(" DoOutErr:" + http_request.status + "!");
  			}
  		}
  		http_request.open( "PATCH", "do_value/slot_0", true );
  		http_request.send(szPatchData);
  	}
  	catch(e)
  	{
  		alert(e);
  	}
  }  
  
  function httpGetDiData()
  {
  	var http_request = null;
  	
  	try
  	{
  		if (diPolling == 0)
  		{
  			diWaitCount = 0;
  			if (window.XMLHttpRequest)
  			{// code for IE7+, Firefox, Chrome, Opera, Safari
  				http_request=new XMLHttpRequest();
  			}
  			else
  			{// code for IE6, IE5
  				http_request=new ActiveXObject("Microsoft.XMLHTTP");
  			}
  			
  			http_request.onreadystatechange=function()
  			{			
  				if (http_request.readyState==4)
  				{
  					if (http_request.status==200)
  					{						
  						try
  						{
  							//Javascript function JSON.parse to parse JSON data
  							var jsonObj;
  							jsonObj = JSON.parse(http_request.responseText);
  							
  							if( jsonObj!=null && jsonObj!=undefined)
  							{
  								for (var iCh=0; iCh<diTotal; iCh++)
  								{
  								 	diStatus[iCh] = jsonObj.DIVal[iCh].Val;
  								}
  					    }
  					    else
        	    	{
        	    		document.getElementById("DIPOLL").innerHTML += " DiErr0:JSON parse failed!";
  				    	}
  				    }
            	catch(e)
            	{
            		document.getElementById("DIPOLL").innerHTML += " DiErr1:ResponseText is not a valid JSON string!";
            	}					  
  					}
  					else
  					{
  						document.getElementById("DIPOLL").innerHTML += " DiErr2:" + http_request.status + "!";
  					}
  					diPolling = 0;
  					diFailCount = 0; // reset fail count
  				}
  			}			
  
  			http_request.open( "GET", "di_value/slot_0", true );
  			http_request.send();
  			diPolling = 1;
  			diPollingCount++;
  			document.getElementById("DIPOLL").innerHTML = "Polling " + diPollingCount + " times...";
  		}
  		else
  		{
  			diWaitCount++;
  			if (diWaitCount == maxWait)
  			{
  				diFailCount++;
  				if (diFailCount < maxFail)
  				{
  					diPolling = 0; // resend
  				}
  			}
  		}
  	}
  	catch(e)
  	{
  		diPolling = 0;
  		document.getElementById("DIPOLL").innerHTML = "DiErr3:" + e + "!";
  	}
  }
  
  function httpGetDoData()
  {
  	var http_request = null;
  	
  	try
  	{
  		if (doPolling == 0)
  		{
  			doWaitCount = 0;
  			if (window.XMLHttpRequest)
  			{// code for IE7+, Firefox, Chrome, Opera, Safari
  				http_request=new XMLHttpRequest();
  			}
  			else
  			{// code for IE6, IE5
  				http_request=new ActiveXObject("Microsoft.XMLHTTP");
  			}
  			http_request.onreadystatechange=function()
  			{		
  				if (http_request.readyState==4)
  				{
  					if (http_request.status==200)
  					{
  						try
  						{
  							//Javascript function JSON.parse to parse JSON data
  							var jsonObj;
  							jsonObj = JSON.parse(http_request.responseText);
  							
  							if( jsonObj!=null && jsonObj!=undefined)
  							{
  								for (var iCh=0; iCh<doTotal; iCh++)
  								{
  								 	doStatus[iCh] = jsonObj.DOVal[iCh].Val;
  								}
  					    }
  					    else
        	    	{
        	    		document.getElementById("DOPOLL").innerHTML += " DiErr0:JSON parse failed!";
  				    	}
  				    }
            	catch(e)
            	{
            		document.getElementById("DOPOLL").innerHTML += " DiErr1:ResponseText is not a valid JSON string!";
            	}						
  
  					}
  					else
  				  {
  						document.getElementById("DOPOLL").innerHTML += " DoErr2:" + http_request.status + "!";
  					}
  					doPolling = 0;
  					doFailCount = 0; // reset fail count
  				}
  			}
  			http_request.open( "GET", "do_value/slot_0", true );
  			http_request.send();
  			doPolling = 1;
  			doPollingCount++;
  			document.getElementById("DOPOLL").innerHTML = "Polling " + doPollingCount + " times...";
  		}
  		else
  		{
  			doWaitCount++;
  			if (doWaitCount == maxWait)
  			{
  				doFailCount++;
  				if (doFailCount < maxFail)
  				{
  					doPolling = 0; // resend
  				}
  			}
  		}
  	}
  	catch(e)
  	{
  		doPolling = 0;
  		document.getElementById("DOPOLL").innerHTML = "DoErr3:" + e + "!";
  	}
  }    

</script>